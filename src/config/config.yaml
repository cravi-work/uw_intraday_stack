system:
  timezone: America/New_York
  base_url: ${UW_BASE_URL:-https://api.unusualwhales.com}
  api_key_env: UW_API_KEY
ingestion:
  watchlist:
  - INTC
  - NFLX
  - TSLA
  cadence_minutes: 5
  ingest_start_et: 04:00
  ingest_end_et: '20:00'
  premarket_start_et: 04:00
  regular_start_et: 09:30
  regular_end_et: '16:00'
  afterhours_end_et: '20:00'
  enable_market_context: true
  volume_profile_top_n: 7
  darkpool_band_width: 0.5
  darkpool_top_n: 7
  wall_top_n: 5
  gex_top_n: 7
validation:
  horizons_minutes: [15, 60]
  flat_threshold_pct: 0.001
  realized_snapshot_tolerance_minutes: 10
  
  # NEW — REQUIRED (no defaults)
  alignment_tolerance_sec: 900
  emit_to_close_horizon: true
  use_default_required_features: false
  fallback_max_age_minutes: 15
  invalid_after_minutes: 60

  # NEW — REQUIRED: explicit weight source
  horizon_weights_source: model   # allowed: model | explicit

  # NEW — REQUIRED: must exist even if source=model
  horizon_weights: {}

  # NEW — REQUIRED if source=model (must include every horizon + to_close)
  horizon_weights_overrides:
    "15": {}
    "60": {}
    "to_close": {}

  # NEW — REQUIRED: must include every horizon + to_close
  horizon_critical_features:
    "15": ["spot", "smart_whale_pressure", "net_gex_sign", "oi_pressure"]
    "60": ["spot", "smart_whale_pressure", "net_gex_sign", "oi_pressure"]
    "to_close": ["spot", "smart_whale_pressure", "net_gex_sign", "oi_pressure"]

network:
  timeout_seconds: 15
  max_retries: 3
  backoff_seconds:
  - 1.0
  - 3.0
  - 5.0
  max_concurrent_requests: 2
  rate_limit_per_second: 1
  circuit_breaker:
    failure_threshold: 5
    cool_down_seconds: 90
    half_open_max_calls: 1
storage:
  duckdb_path: ./uw_stack.duckdb
  writer_lock_path: ./uw_stack.duckdb.lock
  cycle_lock_path: ./uw_cycle.lock
model:
  model_name: bounded_additive_score
  model_version: 1.0.0
  safe_mode_enabled: true
  confidence_cap: 0.55
  min_confidence: 0.35
  neutral_threshold: 0.55
  direction_margin: 0.08
  min_flat_prob: 0.15
  max_flat_prob: 0.65
  flat_from_data_quality_scale: 0.9
  weights:
    smart_whale_pressure: 1.0
    net_gex_sign: 0.6
    net_gamma_exposure_notional: 0.25
    dealer_vanna: 0.5
    dealer_charm: 0.35
    oi_pressure: 0.55
    darkpool_pressure: 0.35
    litflow_pressure: 0.35
    vol_term_slope: 0.15
    vol_skew: 0.10
    iv_rank: 0.05
  calibration:
    bins:
    - 0.0
    - 0.1
    - 0.2
    - 0.3
    - 0.4
    - 0.5
    - 0.6
    - 0.7
    - 0.8
    - 0.9
    - 1.0
    mapped:
    - 0.02
    - 0.08
    - 0.16
    - 0.26
    - 0.38
    - 0.5
    - 0.62
    - 0.74
    - 0.84
    - 0.92
    - 0.98
adapt:
  enabled: true
  rolling_window_predictions: 500
  drift:
    brier_warn: 0.25
    brier_bad: 0.3
    logloss_warn: 0.85
    logloss_bad: 1.1
  bounds:
    weights:
      min: -1.0
      max: 1.0
      max_step: 0.05
    confidence_cap:
      min: 0.55
      max: 0.9
      max_step: 0.05
    flat_from_data_quality_scale:
      min: 0.1
      max: 0.9
      max_step: 0.1
    calibration:
      max_step: 0.05